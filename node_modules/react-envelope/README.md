# React Envelope

Put functional React.js components in an envelope together with default props, advanced local state (presets for common use cases like toggle, counter, ...) and lifecycle hooks.

## Problem

There are two problems that motivated me to create this package:

1.  Functional components don't support local state and lifecycle hooks.
2.  There were no presets for common local state use cases (toggles, counters, ...).

## Solution

This package consists of some higher order components (HOC), which let you define default props, state and lifecycle methods for a functional component. Also you can define state presets like `makeCounterState` or `makeToggleState` that can be used with the `withState` HOC perfectly. If you define state, `react-envelope` will pass a second argument to your functional component ([as described by Andrew Clark](https://twitter.com/acdlite/status/971598256454098944)).

This package uses HOCs and not render props. Don't get me wrong, I use render props a lot, but I think in this case HOCs have slightly advantages like a good separation of concerns and [clean code](https://twitter.com/acdlite/status/971605795501613056).

Technically `react-envelope` makes use of [component squashing](https://twitter.com/acdlite/status/739918904110112770), so the original functional component will be squashed by the HOCs to improve performance.

## Installation

```shell
npm install react-envelope
# or
yarn add react-envelope
```

## Usage

```jsx
import React from 'react';
import { compose, defaultProps, withState, lifecycle, pure } from 'react-envelope';
import makeCounterState from './makeCounterState';

const enhance = compose(
  // Define default props
  defaultProps({
    className: null,
  }),
  // Use state helpers to define state
  withState({
    counter: makeCounterState(),
  }),
  // Use React.js lifecycle hooks with props and state
  lifecycle((props, { counter }) => {
    componentDidUpdate() {
      counter.increment();
    },
  }),
  // Component is pure
  pure(),
});

// Use defined state
function Component(props, state) {
  const { className } = props;
  const { counter } = state;

  return (
    <div className={className}>
      <p>This component was updated {counter.count} times.</p>
      <p>
        <button onClick={() => { counter.reset() }}>Reset counter</button>
      </p>
    </div>
  );
}

export default enhance(Component);
```

Hint: You can use the HOCs of `react-envelope` in conjunction with other higher order components, but thus these higher order components don't expect a functional component with two arguments, HOCs of `react-envelope` should always be placed last, e.g.:

```javascript
const enhance = compose(
  withRouter(...),
  connect(...),
  graphql(...),
  mapProps(...),
  // Use react-envelope HOCs last
  withState(...),
);
```

### Create state helpers

The purpose of this package is to enable a convient way to define state for specific use cases, but not to implement all these use cases. So it is up to you to define state helpers. A state helper is simply an object with the keys `initial` (for initial state) and `mutators` (for state mutator functions):

```javascript
function makeCounterState() {
  return {
    initial: {
      count: 0
    },
    mutators: setState => ({
      increment: () => {
        setState(({ count }) => ({ count: count + 1 }));
      },
      decrement: () => {
        setState(({ count }) => ({ count: count - 1 }));
      },
      reset: () => {
        setState({ count: 0 });
      }
    })
  };
}
```

Then you can reuse this state helper over and over like shown in the example above. For more examples have a look at the [`examples`](https://github.com/ProAI/react-envelope/tree/master/examples) folder.

## Docs

```typescript
// TODOC
type React$StatefulComponent<Props, State> = (props: Props, state: State) =>

type HOC = React$Component | React$StatefulComponent => React$Component
```

### `defaultProps`

```typescript
// TODOC
type DefaultProps = {};
```

### `getDerivedStateFromProps`

_Static lifecycle, introduced in React 16.3_

```typescript
// TODOC
type GetDerivedStateFromProps = {};
```

### `lifecycle`

```typescript
// TODOC
type Lifecycle = {};
```

### `pure`

```typescript
// TODOC
type Pure = () => HOC;
```

### `withState`

```typescript
// TODOC
type WithState = {};
```

### State helper

```typescript
type StateHelper = {
  initial: Object,
  mutators: SetState => Object
};
```

## Inspiration

Definitely this package is inspired by Andrew Clark's great library [`recompose`](https://github.com/acdlite/recompose). And I think you can perfectly use `recompose` and `react-envelope` together, because `recompose` offers a lot more utils. You can use `react-envelope` for state and lifecycle hooks and `recompose` for props manipulation and more.

## License

This package is released under the [MIT License](LICENSE).
